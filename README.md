# FX & US Stock Break-even Simulator

## 概要

米国株を購入した際の **株価 × 為替** の組み合わせに対し、  
売却時の損益分岐点を直感的に可視化する Web ベースのシミュレーターです。

株価と為替を個別に考えるのではなく、
「どの株価・どの為替水準で損益が ±0 になるか」を
グラフ上で一目で把握できることを目的としています。

---

## 背景・解決したかった課題

- 米国株投資では **株価変動と為替変動を同時に考える必要がある**
- Excel では試行錯誤のたびに計算式やグラフを修正する必要があり、操作コストが高い
- 「どの条件でプラス／マイナスになるのか」を直感的に把握しづらい

これらを解決するため、
**ブラウザ上で即座に条件を変更できるシミュレーター**として本ツールを作成しました。

---

## 主な機能

- 株価・為替・購入数量の入力
- 損益分岐点ラインのグラフ表示
- 複数購入（ナンピン）を考慮した計算
- UI 操作に応じたリアルタイム再計算
- モーダル UI による購入情報の管理

---

## 技術スタック

- HTML / CSS / JavaScript（Vanilla JS）
- グラフ描画：JavaScript ベースのチャートライブラリ
- ビルドツール・フレームワークは未使用

※ フレームワークに依存せず、
状態管理および責務分離を自力で設計した場合に、
実装や保守性がどのような構造になるかを検証する目的で実装しました。

## プロジェクト構造

```
fx_simulator/
├── controller/          # イベント制御
│   └── events.js       # ユーザーイベント処理
├── model/               # データ・ビジネスロジック
│   ├── calc.js         # 損益計算ロジック
│   ├── pins.js         # ピン管理
│   └── state.js        # 状態管理
├── view/                # UI・表示ロジック
│   ├── form.js         # フォーム管理
│   ├── plot.js         # グラフ描画
│   ├── pinSettings.js  # ピン設定UI
│   ├── rangeSlider.js  # スライダー制御
│   └── toast.js        # 通知表示
├── index.html           # メインHTML
├── main.js              # エントリーポイント
├── styles.css           # スタイルシート
└── README.md            # このファイル
```

---

## 設計方針

本ツールでは、規模が小さくても **構造を意識した設計** を重視しました。

- MVC ライクな責務分離
  - **Model**：損益計算ロジック
  - **View**：DOM 操作・グラフ描画
  - **Controller**：入力イベントと状態更新の仲介
- 状態管理を一箇所に集約
  - UI 状態・購入情報を `stateController` で一元管理
- 計算ロジックと UI 更新処理の分離
  - 将来的な UI 変更やフレームワーク移行を想定

あとから仕様を変えたり機能を足したりしやすいように、
計算処理・画面表示・入力処理を
できるだけ分けて書くことを意識しました。

---

## 工夫した点

- モーダル画面を開き直すたびに入力内容が消えないよう、
  画面を作り直さず、状態を保持したまま表示・非表示を切り替える構成にしました。

---

## 制約・割り切り

- 型安全性（TypeScript）は未導入
- 単体テストは未実装
- 状態管理ライブラリは不使用

本リポジトリは **完成品というより PoC（設計検証）** という位置づけです。

---

## 外部通信について

本ツールでは、以下の外部通信を行います。

- 為替レート取得のため、`open.er-api.com` にアクセスします  
  （通信に失敗した場合は、固定値を使用して計算を行います）

- UI ライブラリ（Bootstrap / Plotly 等）は CDN 経由で読み込んでいます

---

## 今後の改善案

- TypeScript 化による型安全性向上
- React / Vue などのフレームワークへの移行
- ロジック部分のユニットテスト追加
- UI/UX（モバイル対応・アクセシビリティ）の改善

---

## ライセンス

MIT License
